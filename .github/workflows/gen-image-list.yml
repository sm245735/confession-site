name: ç”¢ç”Ÿåœ–ç‰‡æ¸…å–®

permissions:
  contents: write

on:
  push:
    paths:
      - 'images/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: å»ºç«‹ image-list è³‡æ–™å¤¾
        run: mkdir -p image-list

      - name: æŽƒææ‰€æœ‰è³‡æ–™å¤¾ä¸¦ç”¢ç”Ÿ JSON
        run: |
          # ç”¨ -print0 è®“æ¯å€‹è·¯å¾‘å¾Œé¢åŠ  \0ï¼Œé¿å…ç©ºæ ¼åˆ†å‰²
          find images -mindepth 1 -maxdepth 1 -type d -print0 \
          | while IFS= read -r -d '' folder; do
              basename=$(basename "$folder")
              out="image-list/$basename.json"
              # ls æ™‚ä¹Ÿè¦åŠ  --quoting-style=literal ä¿ç•™åŽŸå
              ls --quoting-style=literal "$folder" \
                | jq -R . | jq -s . > "$out"
              echo "ç”¢ç”Ÿï¼š$out"
            done

      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add image-list/
          git commit -m "ðŸ¤– è‡ªå‹•æ›´æ–° image-list" || echo "æ²’æœ‰è®Šæ›´"
          git push
