name: ç”¢ç”Ÿåœ–ç‰‡æ¸…å–®

on:
  push:
    paths:
      - 'images/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: å»ºç«‹ image-list è³‡æ–™å¤¾
        run: mkdir -p image-list

      - name: æŽƒææ‰€æœ‰è³‡æ–™å¤¾ä¸¦ç”¢ç”Ÿ JSON
        run: |
          folders=$(find images -type d -mindepth 1)
          for folder in $folders; do
            basename=$(basename "$folder")
            out="image-list/$basename.json"
            ls "$folder" | jq -R . | jq -s . > "$out"
            echo "ç”¢ç”Ÿï¼š$out"
          done

      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add image-list/
          git commit -m "ðŸ¤– è‡ªå‹•æ›´æ–° image-list" || echo "æ²’æœ‰è®Šæ›´"
          git push
